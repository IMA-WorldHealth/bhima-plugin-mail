Bhima Mail Plugin
=================

Introduction
------------

The mail plugin allows for customized reports to be emailed on a regular basis.  It is designed to have modular reports
added to it, and easily configured and scheduled via config files.

### Dependencies

To run, the mail plugin must have `q` and `later` installed.   Both are available via npm: `npm install q later`.  By default
`q` is installed with bhima.

### Lifecycle

The 

### Folder organization

The mail plugin is organized in a modular fashion to be realtively stand-alone.  Like all plugins, it is
meant to be run as a child process via the bhima plugin manager.  A breakdown of the components is as
follows:

```bash
# contents of plugins/mail/
addresses/
  - lists.json        # contains the specifications for an address list (composed of contacts from contacts.json)
  - contacts.json     # contains each individual contact's information
archive/
  -                   # contains gzipped archives of previously sent emails (generated by lib/archive)
index.js              # entry point of module.  Instantiates the email plugin, schedules email
lib/
  - archiver.js       # performs gzipped backups of sent emails for future reference
  - query.js          # mail plugin interface to the bhima database
  - render.js         # micro templating engine
reports/              # email reports are specified in individual folders here
  daily/              # template, queries, and data for daily report
    - daily.tmpl.html # html template to be rendered
    lang/             # contains i18n JSONs
      - en.json       # english text
      - fr.json       # french text
    - queries.json    # database queries required for this report.
```

### Philosophy

The mail plugin tries to be as modular and clear as possible.  A single html template is used with
[handlebarjs-style](http://handlebarsjs.com/) markup.  All data queries are contained in a single file,
with name conventions enforced with the templating scheme.

Each email report must be self-contained, with the idea that the mail plugin with call a preprocess
script to generate the HTML template before passing it along to the email sending client.  The benefit
of having to call this preprocessing script for each email is that new reports can be dropped in simply
by copying a file folder and modifying the `plugins` section of the server configuration file.

### Developing new reports

All emails are defined in the `reports/`

### LICENSE

All work herein is licensed as GPLv3.
